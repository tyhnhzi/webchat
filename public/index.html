<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="description" content="Chat thá»i gian thá»±c - Chia sáº» áº£nh">
  
  <title>ğŸ’¬</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="themes.css">
  <link rel="manifest" href="manifest.json">
  
  <style>
    @supports (-webkit-touch-callout: none) {
      input[type="text"],
      textarea,
      button {
        font-size: 16px !important;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="appContainer">
    <!-- Header -->
    <header class="header">
      <h1>ğŸ’¬</h1>
      <p class="subtitle">tyhnhzi.dev</p>
    </header>

    <!-- User Setup Modal -->
    <div class="setup-modal" id="setupModal">
      <div class="setup-card">
        <h2>ChÃ o báº¡n!</h2>
        <input 
          type="text" 
          id="usernameInput" 
          placeholder="Nháº­p tÃªn cá»§a báº¡n..."
          maxlength="200"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        >
        <button onclick="setupUser()" style="width: 100%;">Báº¯t Ä‘áº§u</button>
      </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal" style="display: none;">
      <div class="modal-content profile-modal">
        <span class="close" onclick="closeProfileModal()">&times;</span>
        <div class="profile-header">
          <div class="profile-avatar" id="profileAvatar">ğŸ‘¤</div>
          <h2 id="profileUsername"></h2>
          <p class="profile-status" id="profileStatus"></p>
        </div>
        <div class="profile-body">
          <div class="profile-section">
            <label>ğŸ“ Giá»›i thiá»‡u</label>
            <p id="profileBio" class="profile-bio">ChÆ°a cÃ³ giá»›i thiá»‡u</p>
          </div>
          <div class="profile-section">
            <label>ğŸ“Š Thá»‘ng kÃª</label>
            <div class="profile-stats">
              <div class="stat-item">
                <span class="stat-value" id="profileMessageCount">0</span>
                <span class="stat-label">Tin nháº¯n</span>
              </div>
              <div class="stat-item">
                <span class="stat-value" id="profileJoinDate">-</span>
                <span class="stat-label">Tham gia</span>
              </div>
            </div>
          </div>
          <div class="profile-section" id="editSection" style="display: none;">
            <button onclick="openEditProfile()" class="btn-primary">âœï¸ Chá»‰nh sá»­a trang cÃ¡ nhÃ¢n</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal" style="display: none;">
      <div class="modal-content edit-profile-modal">
        <span class="close" onclick="closeEditProfileModal()">&times;</span>
        <h2>âœï¸ Chá»‰nh sá»­a trang cÃ¡ nhÃ¢n</h2>
        <div class="edit-profile-body">
          <div class="form-group">
            <label>Avatar (Emoji)</label>
            <input type="text" id="editAvatar" placeholder="ğŸ‘¤" maxlength="2">
          </div>
          <div class="form-group">
            <label>Giá»›i thiá»‡u báº£n thÃ¢n</label>
            <textarea id="editBio" placeholder="Viáº¿t vÃ i dÃ²ng vá» báº¡n..." maxlength="200" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>Tráº¡ng thÃ¡i</label>
            <select id="editStatus">
              <option value="online">ğŸŸ¢ Hoáº¡t Ä‘á»™ng</option>
              <option value="away">ğŸŸ¡ Váº¯ng máº·t</option>
              <option value="busy">ğŸ”´ Báº­n</option>
              <option value="offline">âš« áº¨n</option>
            </select>
          </div>
          <button onclick="saveProfile()" class="btn-primary">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
        </div>
      </div>
    </div>

    <!-- Voice Recorder Modal -->
    <div class="modal" id="voiceRecorderModal" style="display: none;">
      <div class="modal-content voice-recorder-modal">
        <span class="close" onclick="closeVoiceRecorder()">&times;</span>
        <h2>ğŸ¤ Ghi Ã‚m Tin Nháº¯n</h2>
        <div class="voice-recorder-body">
          <div class="recorder-display">
            <div class="recorder-time" id="recorderTime">00:00</div>
            <div class="recorder-waveform" id="recorderWaveform">
              <div class="wave"></div>
              <div class="wave"></div>
              <div class="wave"></div>
              <div class="wave"></div>
              <div class="wave"></div>
            </div>
          </div>
          <div class="recorder-controls">
            <button onclick="startVoiceRecording()" id="startRecordBtn" class="recorder-btn recording">ğŸ”´ Ghi</button>
            <button onclick="stopVoiceRecording()" id="stopRecordBtn" class="recorder-btn" style="display: none;">â¹ï¸ Dá»«ng</button>
          </div>
          <div id="voicePlayback" style="display: none; margin-top: 16px;">
            <audio id="voiceAudio" controls style="width: 100%; margin-bottom: 12px;"></audio>
            <div style="display: flex; gap: 8px;">
              <button onclick="sendVoiceMessage()" class="btn-primary" style="flex: 1;">âœ… Gá»­i</button>
              <button onclick="reRecordVoice()" class="btn-secondary" style="flex: 1;">ğŸ”„ Ghi Láº¡i</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main" id="mainContent" style="display: none;">
      <!-- Sidebar - Message History by Months -->
      <aside class="sidebar">
        <div class="sidebar-title">ğŸ“…ThÃ¡ng</div>
        <div class="month-list" id="monthList">
          <div class="month-item active" onclick="filterMessages('all', this);">
            ğŸ”¥Táº¥t cáº£
          </div>
        </div>
      </aside>

      <!-- Messages Display Area -->
      <section class="chat-area">
        <!-- Messages Container -->
        <div class="messages-container" id="messagesContainer">
          <div class="empty-state">
            HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn chia sáº»!
          </div>
        </div>

        <!-- Message Input with Tools -->
        <div class="input-area">
          <div class="input-tools">
            <input 
              type="file" 
              id="imageInput" 
              accept="image/*" 
              style="display: none;"
              onchange="uploadImage()"
            >
            <input 
              type="file" 
              id="videoInput" 
              accept="video/*" 
              style="display: none;"
              onchange="uploadVideo()"
            >
            <button onclick="document.getElementById('imageInput').click()" class="tool-btn" title="Gá»­i áº£nh">ğŸ–¼ï¸</button>
            <button onclick="document.getElementById('videoInput').click()" class="tool-btn" title="Gá»­i video">ğŸ¥</button>
            <button onclick="toggleVoiceRecorder()" class="tool-btn" id="voiceBtn" title="Ghi Ã¢m">ğŸ¤</button>
          </div>
          
          <textarea 
            id="messageInput" 
            placeholder="Nháº­p tin nháº¯n..."
            rows="2"
            autocomplete="off"
            spellcheck="false"
            maxlength="1000"
          ></textarea>
          <button onclick="sendMessage()" class="send-btn" title="Gá»­i (Enter)">ğŸ“¤</button>
        </div>
      </section>
    </div>

    <!-- User Info Footer -->
    <div class="user-info" id="userInfo">
      <div class="user-left">
        <span id="usernameDisplay"></span>
      </div>
      <div class="theme-selector">
        <label>ğŸ¨ Theme:</label>
        <div class="theme-options">
          <button class="theme-btn theme-dark" onclick="setTheme('dark')" title="Dark"></button>
          <button class="theme-btn theme-light" onclick="setTheme('light')" title="Light"></button>
          <button class="theme-btn theme-ocean" onclick="setTheme('ocean')" title="Ocean"></button>
          <button class="theme-btn theme-forest active" onclick="setTheme('forest')" title="Forest"></button>
        </div>
      </div>
      <div class="user-right">
        <span id="onlineCount"></span>
        <button onclick="openBackgroundUploader()" title="ğŸ–¼ï¸ Äá»•i Background">ğŸ–¼ï¸</button>
        <button onclick="removeBackground()" title="ğŸ—‘ï¸ XoÃ¡ Background">ğŸ—‘ï¸</button>
        <button onclick="logout()" title="ÄÄƒng xuáº¥t">ğŸšª</button>
      </div>
    </div>
  </div>

  <!-- Socket.io Library -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <!-- Cropper.js for image cropping -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
  
  <!-- App Scripts -->
  <script src="script.js"></script>
  <script>
    // Register Service Worker for PWA notifications
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(err => console.log('SW registration failed:', err));
    }
  </script>
</body>
</html>
